#!/bin/bash

CSI=$(echo -en "\x1b[")
OSC=$(echo -en "\x1b]")
COMMAND_END=$(echo -en "\x07")
INSERT_HTML="${OSC}1866;0;"

ishterminal() {
  if [ ! -t 0 ]; then
    return 1
  fi
  if [ ! -t 1 ]; then
    return 1
  fi
}

htmlspecialchars() {
  sed 's/&/\&amp;/g;s/"/\&quot;/g;s/'\''/\&#39;/g;s/</\&lt;/g;s/>/\&gt;/g'
}

command=$1
shift
case $command in
  "echo")
    echo "${INSERT_HTML}""$@""${COMMAND_END}"
    ;;
  "cat")
    echo -n "${INSERT_HTML}<iframe srcdoc=\""
    cat "$@" | htmlspecialchars
    echo "\"></iframe>${COMMAND_END}"
    ;;
  *)
    echo "Invalid command: $command" >&2
    exit 1
esac
